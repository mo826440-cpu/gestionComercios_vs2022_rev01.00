@using Client.Services
@inject INetworkService NetworkService
@implements IDisposable

@if (showOfflineBanner)
{
    <div class="alert alert-warning alert-dismissible fade show mb-0" role="alert" style="border-radius: 0;">
        <strong>⚠️ Sin conexión:</strong> Estás trabajando en modo offline. Los cambios se sincronizarán cuando se restaure la conexión.
        <button type="button" class="btn-close" @onclick="DismissBanner" aria-label="Cerrar"></button>
    </div>
}

@code {
    private bool showOfflineBanner = false;

    protected override async Task OnInitializedAsync()
    {
        NetworkService.OnConnectionChanged += HandleConnectionChanged;
        await NetworkService.InitializeAsync();
        
        // Verificar estado inicial
        var isOnline = await NetworkService.IsOnlineAsync();
        showOfflineBanner = !isOnline;
        StateHasChanged();
    }

    private void HandleConnectionChanged(bool isOnline)
    {
        InvokeAsync(() =>
        {
            showOfflineBanner = !isOnline;
            StateHasChanged();
        });
    }

    private void DismissBanner()
    {
        showOfflineBanner = false;
        StateHasChanged();
    }

    public void Dispose()
    {
        NetworkService.OnConnectionChanged -= HandleConnectionChanged;
    }
}

